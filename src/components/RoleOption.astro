---
import { t, loadI18n } from "../lib/i18n";

await loadI18n();
const lang = Astro.currentLocale;

// SettingsCard.astro
interface Props {
  /** 
   * Toggle option.
   * Pass `default: true` for ON, `default: false` for OFF.
   */
  toggle?: { default: boolean };

  /**
   * Numeric option.
   * `default` is the starting value.
   * `min` and `max` define the allowed range and are optional.
   * `step` is optional.
   */
  numeric?: { default: number; min?: number; max?: number; };

  /**
   * Multiplier option.
   * `default` is a string like "1.25".
   * `min`, `max`, `step` are optional numeric bounds.
   */
  multiplier?: { default: number; min?: number; max?: number; };

  /**
   * Time option.
   * `default` is a number like "15.5".
   * `min`, `max`, `step` are optional numeric bounds (seconds).
   */
  time?: { default: number; min?: number; max?: number; };

  /**
   * Array option.
   * IMPORTANT: Put the default item as the **first element** in `options`.
   * The component will treat `options[0]` as the default.
   *
   * Example:
   * array: { options: ["Amnesiac", "Pursuer", "Follower", "Maverick"] }
   * â†’ "Amnesiac" will be displayed as the default.
   */
  array?: { options: string[] };
}


const { toggle, numeric, multiplier, time, array } = Astro.props;
---

<section class="card">
    {
        toggle && (
            <div class="toggle-display">
                <span class="font-bold">{t('default', lang)}:</span> <span
                    class="font-monospace"
                >
                    {toggle.default === true ? t('toggle.on', lang) : t('toggle.off', lang)}
                </span>
            </div>
        )
    }

    {
        numeric && (
            <div class="numeric-display">
                <div class="numeric-value">
                    <span class="font-bold">{t('default', lang)}: </span><span class="font-monospace">{numeric.default}</span>
                </div>
                {
                    (numeric.min || numeric.max) && (
                        <div class="numeric-range">
                            <span class="font-bold">{t('range', lang)}: </span>[<span class="font-monospace">{numeric.min ?? "?"} - {numeric.max ?? "?"}</span>]
                        </div>
                    )
                }
            </div>
        )
    }

    {
        multiplier && (
            <div class="multiplier-display">
                <span class="multiplier-value">
                    <span class="font-bold">{t('default', lang)}:</span> <span class="font-monospace">{multiplier.default}{t('units.multiplier', lang)}</span>
                </span>
                {
                    (multiplier.min || multiplier.max) && (
                        <span class="multiplier-range">
                            {t('range', lang)}: [<span class="font-monospace">{multiplier.min ?? "?"}{t('units.multiplier', lang)} - {multiplier.max ?? "?"}{t('units.multiplier', lang)}</span>]
                        </span>
                    )
                }
            </div>
        )
    }

    {
        time && (
            <div class="time-display">
                <span class="time-value">
                    <span class="font-bold">{t('default', lang)}:</span> <span class="font-monospace">{time.default}{t('units.seconds', lang)}</span>
                </span>
                {
                    (time.min || time.max) && (
                        <span class="time-range">
                            {t('range', lang)}: [<span class="font-monospace">{time.min ?? "?"}{t('units.seconds', lang)} - {time.max ?? "?"}{t('units.seconds', lang)}</span>]
                        </span>    
                    )
                }
            </div>

        )
    }

    {
        array && (
            <div class="array-display">
                <div class="array-options">
                    {array.options.map((opt, i) => (
                        <span class="comma-separator">,</span>
                        <span
                            class={`array-tag ${i === 0 ? "default" : ""}`}
                        >
                            {opt}
                        </span>
                    ))}
                </div>
            </div>
        )
    }

    <div class="card-text">
        <p class="card-desc"><slot /></p>
    </div>
</section>

<style>
    /* Card container */
    .card {
        margin-top: 0;
    }
    .card-title {
        font-weight: 700;
        font-size: 1rem;
        margin-bottom: 4px;
    }
    .font-monospace {
        font-size: 0.9rem;
        background-color: var(--sl-color-gray-6);
        padding: 0.1rem 0.2rem;
    }

    /* Numeric */
    .numeric-display {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
        margin-top: 0.75rem;
    }

    .numeric-range {
        margin-top: 0;
    }

    .time-display,
    .multiplier-display {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    margin-top: 0.75rem;
    }

    .time-range,
    .multiplier-range {
    color: var(--sl-color-text-secondary);
    }

    .array-options {
        display: flex;
        flex-wrap: wrap;
    }

    .comma-separator {
        padding-right: 0.3rem;
    }

    .comma-separator:first-of-type{
        display: none;
    }

    .array-tag {
        font-family: monospace;
        font-size: 0.875rem;
        border-radius: 8px;
        background-color: var(--sl-color-gray-6);
        color: var(--sl-color-text-secondary);
        border: 1px solid var(--sl-color-border);
        padding: 0 0.3rem;
    }

    .array-tag.default {
        text-decoration: underline;
    }
</style>
