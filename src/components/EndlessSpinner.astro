<!-- Load the l-infinity spinner from LDRS CDN -->
<script
  type="module"
  src="https://cdn.jsdelivr.net/npm/ldrs/dist/auto/infinity.js"></script>

<!-- Spinner + container for typewriter loading message -->
<div id="global-spinner">
  <l-infinity
    size="85"
    stroke="6"
    stroke-length="0.4"
    bg-opacity="0.08"
    speed="0.8"
    color="#ffff44"></l-infinity>
  <div class="loading-text" id="ehr-loading-text"></div>
</div>

<script>
  const spinner = document.getElementById("global-spinner");

  const STORAGE_KEY = "hasSeenLoader";
  const hasSeenLoader = sessionStorage.getItem(STORAGE_KEY);

  if (!hasSeenLoader) {

    sessionStorage.setItem(STORAGE_KEY, "true");

    document.body.classList.add("first-load");
    document.body.classList.add("loading");
    if (spinner) spinner.classList.add("blur-active");

    const loadingMessages = [
      "Syncing Host Protocol...",
      "Booting Role Matrix...",
      "Calibrating Endless Hosts...",
      "Engaging Skeld Interface...",
      "Aligning Game Modes...",
      "Initializing Role Nexus...",
      "Assembling Custom Teams...",
      "Assigning Add-Ons...",
      "Linking Vent Grid...",
      "Injecting Reactor Cooldown...",
      "Switching Game Presets...",
      "Bypassing Innersloth's Restrictions...",
    ];

    const message =
      loadingMessages[Math.floor(Math.random() * loadingMessages.length)];
    const textEl = document.getElementById("ehr-loading-text");

    if (textEl !== null) {
      let i = 0;
      const typingSpeed = 45;
      const typeWriter = () => {
        if (i < message.length) {
          textEl.textContent += message.charAt(i);
          i++;
          setTimeout(typeWriter, typingSpeed);
        }
      };
      typeWriter();
    }

    window.addEventListener("load", () => {
      const waitTime = 1000;

      setTimeout(() => {
        if (spinner) {
          spinner.classList.add("fade-out");
          spinner.addEventListener("transitionend", () => spinner.remove());
        }
        document.body.classList.remove("loading");
      }, waitTime);
    });
  } else {
    if (spinner) spinner.remove();
    document.body.classList.remove("loading");
  }

  const header =
    document.querySelector("header") || document.querySelector(".header");

  window.addEventListener("scroll", () => {
    if (window.scrollY > 0) {
      header?.classList.add("scrolled");
    } else {
      header?.classList.remove("scrolled");
    }
  });
</script>
